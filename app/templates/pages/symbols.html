{% extends "layouts/base.html" %}

{% block title %}Symbols Management - Trading Signals{% endblock %}

{% block page_title %}Symbols Management{% endblock %}

{% block content %}
<div x-data="symbolsApp()" x-init="init()">
    <!-- Header Section -->
    <div
        class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 pb-6 border-b border-gray-200">
        <div class="flex items-center mb-4 sm:mb-0">
            <i class="fas fa-coins text-blue-600 text-2xl mr-3"></i>
            <h1 class="text-3xl font-bold text-gray-800">Symbols Management</h1>
        </div>

        <div class="flex flex-wrap gap-3">
            <button @click="openAddSymbolModal()"
                class="flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors">
                <i class="fas fa-plus mr-2"></i>
                Add Symbol
            </button>

            <button @click="importSymbols()"
                class="flex items-center px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-lg hover:bg-green-700 transition-colors">
                <i class="fas fa-upload mr-2"></i>
                Import
            </button>

            <button @click="exportSymbols()"
                class="flex items-center px-4 py-2 text-sm font-medium text-white bg-yellow-600 rounded-lg hover:bg-yellow-700 transition-colors">
                <i class="fas fa-download mr-2"></i>
                Export
            </button>
        </div>
    </div>

    <!-- Symbol Stats -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <div class="flex items-center">
                <div class="p-2 bg-blue-100 rounded-lg">
                    <i class="fas fa-coins text-blue-600 text-xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-600">Total Symbols</p>
                    <p class="text-2xl font-bold text-gray-900" x-text="stats.total || '0'"></p>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <div class="flex items-center">
                <div class="p-2 bg-green-100 rounded-lg">
                    <i class="fas fa-check-circle text-green-600 text-xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-600">Active Symbols</p>
                    <p class="text-2xl font-bold text-gray-900" x-text="stats.active || '0'"></p>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <div class="flex items-center">
                <div class="p-2 bg-red-100 rounded-lg">
                    <i class="fas fa-pause-circle text-red-600 text-xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-600">Inactive Symbols</p>
                    <p class="text-2xl font-bold text-gray-900" x-text="stats.inactive || '0'"></p>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <div class="flex items-center">
                <div class="p-2 bg-purple-100 rounded-lg">
                    <i class="fas fa-chart-line text-purple-600 text-xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-600">VN Symbols</p>
                    <p class="text-2xl font-bold text-gray-900" x-text="stats.vn || '0'"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Filters Section -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 mb-6">
        <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-lg font-semibold text-gray-900 flex items-center">
                <i class="fas fa-filter mr-2 text-blue-600"></i>
                Filters & Search
            </h3>
        </div>
        <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <!-- Search Input -->
                <div class="lg:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Search Symbols</label>
                    <div class="relative">
                        <input type="text" x-model="filters.search" @input.debounce.500ms="applyFilters()"
                            placeholder="Search by symbol, name, or exchange..."
                            class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fas fa-search text-gray-400"></i>
                        </div>
                    </div>
                </div>

                <!-- Exchange Filter -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Exchange</label>
                    <select x-model="filters.exchange" @change="applyFilters()"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">All Exchanges</option>
                        <template x-for="exchange in exchanges" :key="exchange">
                            <option :value="exchange" x-text="exchange"></option>
                        </template>
                    </select>
                </div>

                <!-- Status Filter -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                    <select x-model="filters.status" @change="applyFilters()"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">All Status</option>
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </div>
            </div>

            <div class="flex flex-wrap gap-3 mt-4">
                <button @click="applyFilters()"
                    class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors">
                    Apply Filters
                </button>
                <button @click="clearFilters()"
                    class="px-4 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
                    Clear Filters
                </button>
                <button @click="refreshData()"
                    class="px-4 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
                    <i class="fas fa-sync-alt mr-2" :class="loading ? 'animate-spin' : ''"></i>
                    Refresh
                </button>
            </div>
        </div>
    </div>

    <!-- Symbols Table - HTMX Target -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200">
        <div class="px-6 py-4 border-b border-gray-200">
            <div class="flex items-center justify-between">
                <h3 class="text-lg font-semibold text-gray-900">Symbols List</h3>
                <div class="flex items-center space-x-2">
                    <span class="text-sm text-gray-500">Auto-refresh: 60s</span>
                    <button @click="exportSymbols()"
                        class="px-3 py-1 text-sm text-blue-600 hover:bg-blue-50 rounded-md transition-colors">
                        <i class="fas fa-download mr-1"></i>Export
                    </button>
                </div>
            </div>
        </div>

        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Symbol</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Name</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Exchange</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Market</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Status</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Last Update</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Actions</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200" x-html="symbolsTableHTML">
                    <!-- Symbols will be loaded here -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Add Symbol Modal -->
    <div x-show="showAddModal" x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
        x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0" class="fixed inset-0 z-50 overflow-y-auto" style="display: none;">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" @click="closeAddSymbolModal()">
            </div>

            <div
                class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <form @submit.prevent="saveSymbol()">
                    <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <div class="sm:flex sm:items-start">
                            <div
                                class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 sm:mx-0 sm:h-10 sm:w-10">
                                <i class="fas fa-plus text-blue-600"></i>
                            </div>
                            <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                                <h3 class="text-lg leading-6 font-medium text-gray-900">Add New Symbol</h3>
                                <div class="mt-4 space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Ticker</label>
                                        <input type="text" x-model="newSymbol.ticker" required
                                            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Name</label>
                                        <input type="text" x-model="newSymbol.name"
                                            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Exchange</label>
                                        <input type="text" x-model="newSymbol.exchange"
                                            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Currency</label>
                                        <select x-model="newSymbol.currency"
                                            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                            <option value="USD">USD</option>
                                            <option value="EUR">EUR</option>
                                            <option value="BTC">BTC</option>
                                            <option value="ETH">ETH</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Market Type</label>
                                        <select x-model="newSymbol.market_type"
                                            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                            <option value="US">US Market</option>
                                            <option value="VN">VN Market</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                        <button type="submit"
                            class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                            Save Symbol
                        </button>
                        <button type="button" @click="closeAddSymbolModal()"
                            class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    function symbolsApp() {
        return {
            // State
            loading: false,
            showAddModal: false,
            exchanges: ['NASDAQ', 'NYSE', 'HOSE', 'HNX', 'UPCOM'],
            symbols: [],
            stats: {
                total: 0,
                active: 0,
                inactive: 0,
                vn: 0
            },
            symbolsTableHTML: '',

            // Filters
            filters: {
                search: '',
                exchange: '',
                status: ''
            },

            // New symbol form
            newSymbol: {
                ticker: '',
                name: '',
                exchange: '',
                currency: 'USD',
                market_type: 'US'
            },

            // Methods
            async init() {
                await this.loadSymbols();
                await this.loadStats();
            },

            async loadSymbols() {
                try {
                    this.loading = true;
                    console.log('Loading symbols...');
                    const response = await fetch('/api/v1/symbols');
                    const data = await response.json();
                    console.log('API response:', data);

                    if (data.success && data.data.items) {
                        this.symbols = data.data.items;
                        console.log('Symbols loaded:', this.symbols.length);
                        this.renderSymbolsTable();
                    } else {
                        console.log('No symbols data found');
                    }
                } catch (error) {
                    console.error('Error loading symbols:', error);
                    this.showNotification('Error loading symbols', 'error');
                } finally {
                    this.loading = false;
                }
            },

            async loadStats() {
                try {
                    const response = await fetch('/api/v1/symbols');
                    const data = await response.json();

                    if (data.success && data.data.items) {
                        const symbols = data.data.items;
                        this.stats = {
                            total: symbols.length,
                            active: symbols.filter(s => s.active).length,
                            inactive: symbols.filter(s => !s.active).length,
                            vn: symbols.filter(s => s.exchange === 'HOSE' || s.exchange === 'HNX' || s.exchange === 'UPCOM').length
                        };
                    }
                } catch (error) {
                    console.error('Error loading stats:', error);
                }
            },

            renderSymbolsTable() {
                if (this.symbols.length === 0) {
                    this.symbolsTableHTML = `
                        <tr>
                            <td colspan="7" class="text-center text-gray-500 py-8">
                                <div class="flex items-center justify-center">
                                    <i class="fas fa-inbox mr-2"></i>
                                    No symbols found
                                </div>
                            </td>
                        </tr>
                    `;
                    return;
                }

                this.symbolsTableHTML = this.symbols.map(symbol => `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 h-10 w-10">
                                    <div class="h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center">
                                        <span class="text-sm font-medium text-blue-600">${symbol.ticker.charAt(0)}</span>
                                    </div>
                                </div>
                                <div class="ml-4">
                                    <div class="text-sm font-medium text-gray-900">${symbol.ticker}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-900">${symbol.name || 'N/A'}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800">
                                ${symbol.exchange || 'N/A'}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${symbol.exchange === 'HOSE' || symbol.exchange === 'HNX' || symbol.exchange === 'UPCOM' ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800'}">
                                ${symbol.exchange === 'HOSE' || symbol.exchange === 'HNX' || symbol.exchange === 'UPCOM' ? 'VN' : 'US'}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${symbol.active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                ${symbol.active ? 'Active' : 'Inactive'}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            ${symbol.created_at ? new Date(symbol.created_at).toLocaleDateString() : 'N/A'}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <div class="flex space-x-2">
                                <button onclick="viewSymbol(${symbol.id})" class="text-blue-600 hover:text-blue-900">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button onclick="editSymbol(${symbol.id})" class="text-yellow-600 hover:text-yellow-900">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="toggleSymbolStatus(${symbol.id}, ${symbol.active})" class="text-${symbol.active ? 'red' : 'green'}-600 hover:text-${symbol.active ? 'red' : 'green'}-900">
                                    <i class="fas fa-${symbol.active ? 'pause' : 'play'}"></i>
                                </button>
                                <button onclick="deleteSymbol(${symbol.id})" class="text-red-600 hover:text-red-900">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            },

            async refreshData() {
                await this.loadSymbols();
                await this.loadStats();
            },

            applyFilters() {
                // Filter symbols based on current filters
                let filteredSymbols = this.symbols;

                if (this.filters.search) {
                    const search = this.filters.search.toLowerCase();
                    filteredSymbols = filteredSymbols.filter(symbol =>
                        symbol.symbol.toLowerCase().includes(search) ||
                        (symbol.name && symbol.name.toLowerCase().includes(search)) ||
                        (symbol.exchange && symbol.exchange.toLowerCase().includes(search))
                    );
                }

                if (this.filters.exchange) {
                    filteredSymbols = filteredSymbols.filter(symbol =>
                        symbol.exchange === this.filters.exchange
                    );
                }

                if (this.filters.status) {
                    const isActive = this.filters.status === 'active';
                    filteredSymbols = filteredSymbols.filter(symbol =>
                        symbol.active === isActive
                    );
                }

                // Temporarily replace symbols for display
                const originalSymbols = this.symbols;
                this.symbols = filteredSymbols;
                this.renderSymbolsTable();
                this.symbols = originalSymbols;
            },

            clearFilters() {
                this.filters = {
                    search: '',
                    exchange: '',
                    status: ''
                };
                this.renderSymbolsTable();
            },

            openAddSymbolModal() {
                this.showAddModal = true;
                this.newSymbol = {
                    ticker: '',
                    name: '',
                    exchange: '',
                    currency: 'USD',
                    market_type: 'US'
                };
            },

            closeAddSymbolModal() {
                this.showAddModal = false;
            },

            async saveSymbol() {
                try {
                    const response = await fetch('/api/v1/symbols', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(this.newSymbol)
                    });

                    if (response.ok) {
                        this.closeAddSymbolModal();
                        await this.refreshData();
                        this.showNotification('Symbol added successfully!', 'success');
                    } else {
                        this.showNotification('Error adding symbol', 'error');
                    }
                } catch (error) {
                    console.error('Error saving symbol:', error);
                    this.showNotification('Error adding symbol', 'error');
                }
            },

            async importSymbols() {
                // Create file input for CSV import
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.csv';
                input.onchange = async (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const formData = new FormData();
                        formData.append('file', file);

                        try {
                            const response = await fetch('/api/v1/symbols/import', {
                                method: 'POST',
                                body: formData
                            });

                            if (response.ok) {
                                await this.refreshData();
                                this.showNotification('Symbols imported successfully!', 'success');
                            } else {
                                this.showNotification('Error importing symbols', 'error');
                            }
                        } catch (error) {
                            console.error('Error importing symbols:', error);
                            this.showNotification('Error importing symbols', 'error');
                        }
                    }
                };
                input.click();
            },

            async exportSymbols() {
                try {
                    const response = await fetch('/api/v1/symbols/export');
                    if (response.ok) {
                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `symbols_${new Date().toISOString().split('T')[0]}.csv`;
                        document.body.appendChild(a);
                        a.click();
                        window.URL.revokeObjectURL(url);
                        document.body.removeChild(a);
                        this.showNotification('Symbols exported successfully!', 'success');
                    } else {
                        this.showNotification('Error exporting symbols', 'error');
                    }
                } catch (error) {
                    console.error('Error exporting symbols:', error);
                    this.showNotification('Error exporting symbols', 'error');
                }
            },

            showNotification(message, type) {
                // Use the global notification function from base template
                if (typeof showNotification === 'function') {
                    showNotification(message, type);
                } else {
                    alert(message);
                }
            }
        }
    }

    // Global functions for table actions
    async function viewSymbol(id) {
        try {
            const response = await fetch(`/api/v1/symbols/${id}`);
            const data = await response.json();

            if (data.success) {
                const symbol = data.data;
                // Show symbol details in a modal or redirect to detail page
                showNotification(`Viewing ${symbol.symbol} - ${symbol.name || 'N/A'}`, 'info');
                // You can implement a detailed view modal here
            } else {
                showNotification('Error loading symbol details', 'error');
            }
        } catch (error) {
            console.error('Error viewing symbol:', error);
            showNotification('Error loading symbol details', 'error');
        }
    }

    async function editSymbol(id) {
        try {
            const response = await fetch(`/api/v1/symbols/${id}`);
            const data = await response.json();

            if (data.success) {
                const symbol = data.data;
                // Populate the add modal with existing data for editing
                const app = Alpine.store('symbolsApp') || document.querySelector('[x-data*="symbolsApp"]').__x.$data;
                if (app) {
                    app.newSymbol = {
                        ticker: symbol.symbol,
                        name: symbol.name || '',
                        exchange: symbol.exchange || '',
                        currency: symbol.currency || 'USD',
                        market_type: symbol.market_type || 'US'
                    };
                    app.showAddModal = true;
                    // Change modal title to "Edit Symbol"
                    document.querySelector('.modal-title').textContent = 'Edit Symbol';
                }
            } else {
                showNotification('Error loading symbol for editing', 'error');
            }
        } catch (error) {
            console.error('Error editing symbol:', error);
            showNotification('Error loading symbol for editing', 'error');
        }
    }

    async function toggleSymbolStatus(id, isActive) {
        try {
            const response = await fetch(`/api/v1/symbols/${id}/toggle`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ active: !isActive })
            });

            if (response.ok) {
                const data = await response.json();
                if (data.success) {
                    showNotification(`Symbol ${!isActive ? 'activated' : 'deactivated'} successfully!`, 'success');
                    // Refresh the symbols list
                    const app = Alpine.store('symbolsApp') || document.querySelector('[x-data*="symbolsApp"]').__x.$data;
                    if (app) {
                        await app.refreshData();
                    }
                } else {
                    showNotification('Error updating symbol status', 'error');
                }
            } else {
                showNotification('Error updating symbol status', 'error');
            }
        } catch (error) {
            console.error('Error toggling symbol status:', error);
            showNotification('Error updating symbol status', 'error');
        }
    }

    async function deleteSymbol(id) {
        if (confirm('Are you sure you want to delete this symbol? This action cannot be undone.')) {
            try {
                const response = await fetch(`/api/v1/symbols/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        showNotification('Symbol deleted successfully!', 'success');
                        // Refresh the symbols list
                        const app = Alpine.store('symbolsApp') || document.querySelector('[x-data*="symbolsApp"]').__x.$data;
                        if (app) {
                            await app.refreshData();
                        }
                    } else {
                        showNotification('Error deleting symbol', 'error');
                    }
                } else {
                    showNotification('Error deleting symbol', 'error');
                }
            } catch (error) {
                console.error('Error deleting symbol:', error);
                showNotification('Error deleting symbol', 'error');
            }
        }
    }

    function changePage(page) {
        // This function is for pagination if needed
        const app = Alpine.store('symbolsApp') || document.querySelector('[x-data*="symbolsApp"]').__x.$data;
        if (app) {
            // Implement pagination logic here
            console.log('Changing to page:', page);
        }
    }
</script>
{% endblock %}